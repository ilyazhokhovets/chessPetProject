{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n// import userimage from \"@/assets/img/chesspieces/wikipedia/wK.png\";\nimport \"@/chessboardjs/js/chessboard\";\nimport { Chess } from 'chess.js';\nimport Settings from \"@/components/Settings\";\nexport default {\n  name: \"Socket\",\n  components: {\n    Settings\n  },\n  created() {\n    this.connect();\n  },\n  mounted() {\n    this.SuperPuper();\n  },\n  data() {\n    return {\n      username: '23232',\n      source_fen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n      new_fen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n      move_uci: '',\n      who_moved: '',\n      record: false,\n      listMove: [],\n      game: '',\n      board: '',\n      color: 'w',\n      status: 'disconnected',\n      settings: '',\n      cp: '0',\n      pgn: '',\n      win_percent: '',\n      logs: []\n    };\n  },\n  watch: {\n    new_fen() {\n      this.pgn = this.game.pgn();\n      if (this.record && this.game.turn() === this.board.orientation().slice(0, 1)) {\n        this.sendSuggest();\n      }\n    },\n    status() {\n      if (this.status === 'connected') {\n        this.reset();\n      }\n    }\n  },\n  methods: {\n    printLogs() {\n      console.log(this.logs);\n    },\n    winPercent(elem) {\n      if (this.board.orientation() === 'white') {\n        return {\n          text: 'Побед белых %',\n          value: Math.round(elem.white_win * 1000) / 10\n        };\n      }\n      return {\n        text: 'Побед черных %',\n        value: Math.round(elem.black_win * 1000) / 10\n      };\n    },\n    reset() {\n      let fen = this.$store.getters.getSettings;\n      this.game.load(fen.startingFen);\n      this.board.position(this.game.fen());\n      this.record = false;\n      this.source_fen = fen;\n      this.new_fen = this.game.fen();\n      if (this.game.turn() !== this.board.orientation().slice(0, 1)) {\n        this.new_fen = this.game.fen();\n        this.sendMove();\n      } else {\n        this.sendReset();\n      }\n    },\n    hint() {\n      let data = {\n        action: 'hint',\n        fen: this.new_fen\n      };\n      this.chessSocket.send(JSON.stringify(data));\n    },\n    flipBoard() {\n      this.board.flip();\n      this.reset();\n    },\n    compMove(move_uci) {\n      var next_move = this.game.move({\n        from: move_uci.slice(0, 2),\n        to: move_uci.slice(2, 4),\n        promotion: 'q'\n      });\n      this.fen = this.game.fen();\n      this.board.position(this.game.fen());\n    },\n    onDrop(source, target) {\n      // see if the move is legal\n      this.source_fen = this.game.fen();\n      try {\n        var move = this.game.move({\n          from: source,\n          to: target,\n          promotion: 'q' // NOTE: always promote to a queen for example simplicity\n        });\n      } catch (error) {\n        move = null;\n      }\n\n      // illegal move\n      if (move === null) return 'snapback';\n      this.new_fen = this.game.fen();\n      this.move_uci = source + target;\n      this.listMove = [];\n      // this.sendCP()\n      this.sendMove();\n    },\n    editCastleMove(uci) {\n      if (this.game.board()[0][4] != null && this.game.board()[0][4]['type'] === 'k' && uci === 'e8h8') {\n        uci = 'e8g8';\n      }\n      if (this.game.board()[0][4] != null && this.game.board()[0][4]['type'] === 'k' && uci === 'e8a8') {\n        uci = 'e8c8';\n      }\n      if (this.game.board()[7][4] != null && this.game.board()[0][4]['type'] === 'k' && uci === 'e1h1') {\n        uci = 'e1g1';\n      }\n      if (this.game.board()[7][4] != null && this.game.board()[0][4]['type'] === 'k' && uci === 'e1a1') {\n        uci = 'e1c1';\n      }\n      return uci;\n    },\n    SuperPuper() {\n      var board = null;\n      var game = new Chess();\n      function onDragStart(source, piece, position, orientation) {\n        // do not pick up pieces if the game is over\n        if (game.game_over) return false;\n\n        // only pick up pieces for the side to move\n        if (game.turn() === 'w' && piece.search(/^b/) !== -1 || game.turn() === 'b' && piece.search(/^w/) !== -1) {\n          return false;\n        }\n      }\n\n      // update the board position after the piece snap\n      // for castling, en passant, pawn promotion\n      function onSnapEnd() {\n        board.position(game.fen());\n      }\n      var config = {\n        draggable: true,\n        position: 'start',\n        onDragStart: onDragStart,\n        onDrop: this.onDrop,\n        onSnapEnd: onSnapEnd\n      };\n      this.game = game;\n      board = Chessboard('myBoard', config);\n      this.board = board;\n    },\n    connect() {\n      this.chessSocket = new WebSocket('ws://' + '127.0.0.1:8000/ws/chess/');\n      this.chessSocket.onopen = () => {\n        this.status = \"connected\";\n      };\n      this.chessSocket.onmessage = ({\n        data\n      }) => {\n        var recieved_data = JSON.parse(data);\n        recieved_data.r = 'response';\n        console.log(recieved_data);\n        this.logs.push(recieved_data);\n        if (recieved_data.status === 'move') {\n          this.getMove(recieved_data);\n        }\n        if (recieved_data.status === 'cp') {\n          this.getCP(recieved_data);\n        }\n        if (recieved_data.status === 'hint') {\n          this.printHint(recieved_data);\n        }\n        if (recieved_data.status === 'suggest') {\n          this.getSuggest(recieved_data);\n        }\n        if (recieved_data.status === 'fail' || recieved_data.status === 'success') {\n          this.reset();\n        }\n        if (recieved_data.status === 'reset') {\n          this.getReset(recieved_data);\n        }\n      };\n    },\n    printHint(recieved_data) {\n      alert(recieved_data.move_uci);\n    },\n    getMove(recieved_data) {\n      this.record = recieved_data.record;\n      this.source_fen = this.new_fen;\n      this.compMove(recieved_data.move_uci);\n      this.new_fen = this.game.fen();\n      this.who_moved = 'comp';\n      this.sendCP();\n\n      // else {\n      //   this.reset()\n      // }\n    },\n\n    getCP(recieved_data) {\n      this.cp = recieved_data.cp;\n    },\n    sendCP() {\n      let data = {\n        action: 'sendCP',\n        fen: this.new_fen\n      };\n      data.r = 'request';\n      this.logs.push(data);\n      this.chessSocket.send(JSON.stringify(data));\n    },\n    sendSuggest() {\n      let data = {\n        action: 'sendSuggest',\n        fen: this.new_fen,\n        orientation: this.board.orientation()\n      };\n      data.r = 'request';\n      this.logs.push(data);\n      this.chessSocket.send(JSON.stringify(data));\n    },\n    getSuggest(recieved_data) {\n      this.listMove = recieved_data.listMove;\n    },\n    sendReset() {\n      let data = {\n        action: 'reset',\n        fen: this.new_fen\n      };\n      data.r = 'request';\n      this.logs.push(data);\n      this.chessSocket.send(JSON.stringify(data));\n    },\n    getReset(recieved_data) {\n      this.record = recieved_data.record;\n      if (this.record) {\n        this.sendSuggest();\n      }\n    },\n    sendMove() {\n      let data = {\n        action: 'sendMove',\n        fen: this.new_fen,\n        move: this.move_uci,\n        source_fen: this.source_fen,\n        record: this.record,\n        settings: this.$store.getters.getSettings\n      };\n      data.r = 'request';\n      this.logs.push(data);\n      this.chessSocket.send(JSON.stringify(data));\n    }\n  }\n};","map":{"version":3,"mappings":";AAuCA;AACA;AACA;AACA;AACA;EACAA;EACAC;IACAC;EACA;EACAC;IACA;EACA;EACAC;IACA;EAEA;EAEAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EAEAC;IACAd;MAEA;MACA;QAEA;MACA;IACA;IACAQ;MACA;QACA;MACA;IACA;EAEA;EAEAO;IACAC;MACAC;IACA;IACAC;MACA;QACA;UAAAC;UACAC;QACA;MACA;MACA;QAAAD;QACAC;MACA;IACA;IACAC;MACA;MACA;MACA;MAEA;MACA;MACA;MAEA;QAEA;QACA;MAEA,OACA;QAEA;MACA;IACA;IACAC;MACA;QACAC;QACAC;MACA;MAEA;IACA;IACAC;MACA;MAEA;IACA;IACAC;MACA;QACAC;QACAC;QACAC;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;QACA;UACAH;UACAC;UACAC;QACA;MACA,EACA;QACAE;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAGAC;MACA;QACAC;MACA;MACA;QACAA;MACA;MACA;QACAA;MACA;MACA;QACAA;MACA;MAEA;IACA;IAGAC;MAGA;MACA;MAIA;QACA;QACA;;QAEA;QACA,wDACA7B;UACA;QACA;MACA;;MAKA;MACA;MACA;QACAC;MACA;MAGA;QACA6B;QACAC;QACAC;QACAP;QACAQ;MACA;MAEA;MACAhC;MACA;IAEA;IAGAiC;MACA,iCACA,qCACA;MACA;QACA;MAEA;MAEA;QAAA1C;MAAA;QACA;QAEA2C;QACAvB;QACA;QAEA;UACA;QACA;QACA;UAEA;QACA;QACA;UACA;QACA;QACA;UACA;QACA;QACA;UACA;QACA;QAEA;UACA;QACA;MACA;IAEA;IAEAwB;MACAC;IACA;IACAC;MAGA;MACA;MACA;MACA;MACA;MAEA;;MAEA;MACA;MACA;IACA;;IAEAC;MAEA;IAEA;IAEAC;MACA;QACAtB;QACAC;MACA;MACA3B;MACA;MACA;IACA;IACAiD;MACA;QACAvB;QACAC;QACAuB;MACA;MACAlD;MACA;MAEA;IACA;IACAmD;MACA;IACA;IACAC;MACA;QACA1B;QACAC;MACA;MACA3B;MACA;MACA;IACA;IACAqD;MACA;MACA;QACA;MACA;IACA;IAEAC;MAEA;QACA5B;QACAC;QACAO;QACAhC;QACAI;QACAM;MACA;MACAZ;MACA;MACA;IACA;EAEA;AAIA","names":["name","components","Settings","created","mounted","data","username","source_fen","new_fen","move_uci","who_moved","record","listMove","game","board","color","status","settings","cp","pgn","win_percent","logs","watch","methods","printLogs","console","winPercent","text","value","reset","hint","action","fen","flipBoard","compMove","from","to","promotion","onDrop","move","editCastleMove","uci","SuperPuper","draggable","position","onDragStart","onSnapEnd","connect","recieved_data","printHint","alert","getMove","getCP","sendCP","sendSuggest","orientation","getSuggest","sendReset","getReset","sendMove"],"sourceRoot":"src/components","sources":["Socket.vue"],"sourcesContent":["<template>\n<div>\n\n  <div>\n  <input type=\"checkbox\" value=\"record\" id=\"checkbox\" v-model=\"record\" />\n<label for=\"checkbox\"> Режим обучения </label>\n    </div>\n  <div v-model=\"cp\">\n    Оценка позиции: {{ cp/100 }}\n  </div>\n\n\n\n<div id=\"myBoard\" style=\"width: 400px\"></div>\n<button @click=\"flipBoard\">Перевернуть доску</button> <br>\n  <button :disabled=\"record\" @click=\"hint\">Подсказка</button> <br>\n  <button @click=\"reset\">Начать заново</button><br>\n<!--   <ul>-->\n<!--     <li v-for=\"elem in this.logs\">-->\n<!--       {{elem.r}}, {{elem.action || '-'}}, {{elem.status || '-'}}, {{elem.time || '-'}}, {{elem.fen}}-->\n\n<!--     </li>-->\n<!--   </ul>-->\n{{pgn}}\n  <div>\n\n  <ul v-if=\"this.record \">\n    <li v-for=\"elem in this.listMove\">\n      Ход:  {{ elem.move }}, {{ winPercent(elem).text}}  {{ winPercent(elem).value }},  Всего игр:  {{ elem.appearances }}, Оценка:  {{ elem.cp/100}}\n\t </li>\n    </ul>\n</div>\n\n  </div>\n\n</template>\n\n<script>\n\n// import userimage from \"@/assets/img/chesspieces/wikipedia/wK.png\";\nimport  \"@/chessboardjs/js/chessboard\";\n        import { Chess } from 'chess.js'\nimport Settings from \"@/components/Settings\";\nexport default {\n  name: \"Socket\",\n  components: {\n    Settings\n  },\n  created() {\n    this.connect()\n  },\n  mounted() {\n  this.SuperPuper()\n\n  },\n\n  data() {\n    return {\n      username: '23232',\n      source_fen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n      new_fen: 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1',\n      move_uci: '',\n      who_moved: '',\n      record: false,\n      listMove: [],\n      game: '',\n      board: '',\n      color: 'w',\n      status: 'disconnected',\n      settings: '',\n      cp: '0',\n      pgn: '',\n      win_percent: '',\n      logs: [],\n    }\n    },\n\nwatch: {\n    new_fen(){\n\n      this.pgn = this.game.pgn()\n      if (this.record && this.game.turn() === this.board.orientation().slice(0,1)) {\n\n        this.sendSuggest()\n      }\n    },\n  status(){\n      if (this.status === 'connected') {\n        this.reset()\n      }\n  }\n\n},\n\n  methods: {\n    printLogs(){\n      console.log(this.logs)\n    },\n    winPercent (elem){\n      if (this.board.orientation()==='white'){\n        return {text: 'Побед белых %',\n          value: Math.round(elem.white_win*1000)/10\n        }\n      }\n      return  {text: 'Побед черных %',\n          value: Math.round(elem.black_win*1000)/10\n        }\n    },\n    reset (){\n      let fen = this.$store.getters.getSettings\n      this.game.load(fen.startingFen)\n      this.board.position(this.game.fen())\n\n      this.record = false\n      this.source_fen = fen\n      this.new_fen = this.game.fen()\n\n      if (this.game.turn() !== this.board.orientation().slice(0,1)){\n\n        this.new_fen = this.game.fen()\n        this.sendMove()\n\n      }\n      else{\n\n      this.sendReset()\n        }\n    },\n    hint (){\n    let data = {\n         action: 'hint',\n        fen: this.new_fen,\n      }\n\n      this.chessSocket.send(JSON.stringify(data))\n    },\n    flipBoard(){\n      this.board.flip()\n\n      this.reset()\n    },\n  compMove (move_uci){\n     var next_move = this.game.move({\n            from: move_uci.slice(0, 2),\n            to: move_uci.slice(2, 4),\n            promotion: 'q'\n          })\n      this.fen = this.game.fen()\n      this.board.position(this.game.fen())\n    },\n\n  onDrop (source, target) {\n  // see if the move is legal\n  this.source_fen = this.game.fen()\n  try {\n    var move = this.game.move({\n    from: source,\n    to: target,\n    promotion: 'q' // NOTE: always promote to a queen for example simplicity\n  })\n  }\n  catch (error){\n    move = null\n  }\n\n  // illegal move\n  if (move === null) return 'snapback';\n  this.new_fen = this.game.fen()\n  this.move_uci = source+target\n    this.listMove = []\n    // this.sendCP()\n  this.sendMove()\n},\n\n\neditCastleMove(uci){\n   if (this.game.board()[0][4]!=null && this.game.board()[0][4]['type'] === 'k' && uci === 'e8h8') {\n          uci= 'e8g8'\n       }\n   if (this.game.board()[0][4]!=null && this.game.board()[0][4]['type'] === 'k' && uci === 'e8a8') {\n          uci= 'e8c8'\n       }\n   if (this.game.board()[7][4]!=null && this.game.board()[0][4]['type'] === 'k' && uci === 'e1h1') {\n          uci= 'e1g1'\n       }\n   if (this.game.board()[7][4]!=null && this.game.board()[0][4]['type'] === 'k' && uci === 'e1a1') {\n          uci= 'e1c1'\n       }\n\n   return uci\n},\n\n\nSuperPuper(){\n\n\n  var board = null\nvar game = new Chess()\n\n\n\nfunction onDragStart (source, piece, position, orientation) {\n  // do not pick up pieces if the game is over\n  if (game.game_over) return false\n\n  // only pick up pieces for the side to move\n  if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||\n      (game.turn() === 'b' && piece.search(/^w/) !== -1)) {\n    return false\n  }\n}\n\n\n\n\n// update the board position after the piece snap\n// for castling, en passant, pawn promotion\nfunction onSnapEnd () {\n  board.position(game.fen())\n}\n\n\nvar config = {\n  draggable: true,\n  position: 'start',\n  onDragStart: onDragStart,\n  onDrop: this.onDrop,\n  onSnapEnd: onSnapEnd\n}\n\nthis.game = game\nboard = Chessboard('myBoard', config)\nthis.board = board\n\n},\n\n\n    connect() {\n      this.chessSocket = new WebSocket(\n          'ws://' + '127.0.0.1:8000/ws/chess/'\n      );\n      this.chessSocket.onopen = () => {\n        this.status = \"connected\";\n\n      }\n\n      this.chessSocket.onmessage =  ({data}) => {\n      var recieved_data = JSON.parse(data)\n\n      recieved_data.r = 'response'\n      console.log(recieved_data)\n        this.logs.push(recieved_data)\n\n        if (recieved_data.status === 'move') {\n      this.getMove(recieved_data)\n          }\n         if (recieved_data.status === 'cp'){\n\n       this.getCP(recieved_data)\n        }\n         if (recieved_data.status === 'hint'){\n       this.printHint(recieved_data)\n        }\n         if (recieved_data.status === 'suggest'){\n       this.getSuggest(recieved_data)\n        }\n         if (recieved_data.status === 'fail' || recieved_data.status === 'success' ){\n       this.reset()\n        }\n\n         if (recieved_data.status === 'reset'){\n       this.getReset(recieved_data)\n        }\n    }\n\n    },\n\n     printHint(recieved_data){\n      alert(recieved_data.move_uci)\n    },\n     getMove(recieved_data){\n\n\n          this.record = recieved_data.record\n        this.source_fen = this.new_fen\n        this.compMove(recieved_data.move_uci)\n        this.new_fen = this.game.fen()\n        this.who_moved = 'comp'\n\n           this.sendCP()\n\n        // else {\n        //   this.reset()\n        // }\n    },\n\n     getCP(recieved_data){\n\n        this.cp = recieved_data.cp\n\n    },\n\n     sendCP(){\n        let data = {\n         action: 'sendCP',\n        fen: this.new_fen,\n      }\n      data.r = 'request'\n        this.logs.push(data)\n       this.chessSocket.send(JSON.stringify(data))\n    },\n     sendSuggest(){\n        let data = {\n         action: 'sendSuggest',\n        fen: this.new_fen,\n          orientation: this.board.orientation()\n      }\n      data.r = 'request'\n        this.logs.push(data)\n\n       this.chessSocket.send(JSON.stringify(data))\n    },\n     getSuggest(recieved_data){\n      this.listMove = recieved_data.listMove\n    },\n     sendReset(){\n        let data = {\n         action: 'reset',\n        fen: this.new_fen,\n      }\n      data.r = 'request'\n        this.logs.push(data)\n       this.chessSocket.send(JSON.stringify(data))\n    },\n     getReset(recieved_data){\n      this.record = recieved_data.record\n       if (this.record){\n         this.sendSuggest()\n       }\n    },\n\n     sendMove (){\n\n       let data = {\n         action: 'sendMove',\n        fen: this.new_fen,\n        move: this.move_uci,\n        source_fen: this.source_fen,\n        record: this.record,\n         settings: this.$store.getters.getSettings\n      }\n      data.r = 'request'\n        this.logs.push(data)\n       this.chessSocket.send(JSON.stringify(data))\n    },\n\n  }\n\n\n\n}\n</script>\n\n<style scoped>\n@import \"@/assets/css/chessboard-1.0.0.css\"\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}